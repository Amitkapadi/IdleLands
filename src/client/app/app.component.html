<ion-app>
  <ion-split-pane [disabled]="hiddenSplitPane">
    <ion-menu>

      <ion-header>
        <ion-toolbar color="primary">
          <ion-buttons slot="start">
            <ion-button (click)="theCloud()">
              <ion-icon [name]="(gameService.loggedInAndConnected) ? 'cloud' : 'cloud-outline'"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>IdleLands</ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-margin-bottom">

        <ion-list *ngIf="(gameService.player$ | async) as player">
          <ion-item class="big-item" 
                    [routerDirection]="'root'"
                    [routerLink]="['/character']">

            <app-gendervatar slot="start" [gender]="player.gender"></app-gendervatar> 

            <ion-badge class="menu-bottom-left" color="secondary" *ngIf="player.$party">In Party</ion-badge>
            
            <ion-label>
              {{ player.name }}<span *ngIf="player.title">, the {{ player.title }}</span>
              <p>Level {{ player.level.__current }}/{{ player.level.maximum }} {{ player.profession }}</p>
              <p>{{ player.map }}</p>
              <p>{{ player.region }}</p>
            </ion-label>

            <circle-progress
              slot="end"
              [percent]="(player.xp.__current / player.xp.maximum) * 100"
              [radius]="20"
              [outerStrokeWidth]="4"
              [innerStrokeWidth]="0"
              [outerStrokeColor]="'#78C000'"
              [innerStrokeColor]="''"
              [showSubtitle]="false"
              [showUnits]="false"
              [animation]="false"
              [renderOnClick]="false"
              [title]="playerCircleText(player)"
              [backgroundStroke]="'#C7E596'"
              [backgroundStrokeWidth]="2"
              [backgroundPadding]="2"
              [animationDuration]="300"
            ></circle-progress>

          </ion-item>

          <ion-item *ngIf="canUpdate" (click)="doAppUpdate()">
            <ion-icon slot="start" name="logo-ionic"></ion-icon> Update available! Click to update.
          </ion-item>

          <ion-item *ngIf="a2hsPrompt" (click)="a2hs()">
            <ion-icon slot="start" name="add"></ion-icon> Add to Homescreen
          </ion-item>

          <ion-menu-toggle auto-hide="false" 
                           *ngFor="let page of appPages" 
                           [class.ion-hide]="page.hideIf && page.hideIf(player)">

            <ion-item [routerDirection]="'root'" 
                      [routerLink]="[page.url]" 
                      [queryParams]="page.queryParams">

              <ion-icon slot="start" [src]="'assets/icon/category-' + page.icon + '.svg'"></ion-icon>

              <ion-label>
                {{ page.name }} 
              </ion-label>

              <ion-badge slot="end" *ngIf="page.badge && page.badge(player)" [color]="page.badgeColor">
                {{ page.badge(player) }}
              </ion-badge>
            </ion-item>

          </ion-menu-toggle>

          <ion-item (click)="logout()">
            <ion-icon slot="start" [src]="'assets/icon/category-logout.svg'"></ion-icon>

            <ion-label>
              Logout
            </ion-label>
          </ion-item>
          
        </ion-list>
      </ion-content>
      
    </ion-menu>

    <ion-menu side="end" #playerMenu [swipeGesture]="false" type="overlay" [class.ion-hide]="hiddenPlayerMenu">
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Players ({{ gameService.players.length }})</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <div class="blank-slate" *ngIf="gameService.players.length === 0">
          No players here... that means you're offline.
        </div>
        <ion-list>
          <ion-item *ngFor="let player of gameService.players">
            <app-gendervatar slot="start" [gender]="player.gender"></app-gendervatar> 

            <ion-label>
              <h2>{{ player.name }}<span *ngIf="player.title">, the {{ player.title }}</span></h2>
              <p class="vertical-center">
                {{ player.profession }} &nbsp;
                <ion-badge color="secondary"><span *ngIf="player.ascensionLevel">{{ player.ascensionLevel }}â˜…</span>{{ player.level }}</ion-badge>
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-menu>

    <ion-router-outlet main></ion-router-outlet>
  </ion-split-pane>
</ion-app>